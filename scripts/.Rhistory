library(brms)
library(stringr)
library(dplyr)
traits_clean <- read.csv("../data/SUPs_traits - clean_traits.csv", fileEncoding="latin1")
one_phylo <- readRDS("../data/final_phylo.rds")
all_class <- read.csv("../data/classes.csv")
traits_phylo <- traits_clean %>%
dplyr::filter(number_traits_completed ==4) %>%
left_join(all_class, by = c("scientific_name.x" = "scientific_name")) %>%
filter(!(class %in% "Insecta")) %>%
#bind_rows(shark_1) %>%
dplyr::filter(str_replace(scientific_name.x, " ", "_") %in% one_phylo$tip.label) %>%
select(scientific_name.x, dispersal_km, Migration_km, mean.hra.m2, Mass_kg, class, diet_broadest_cat, media_simplified, geographic_range_km2) %>%
mutate(scientific_name.x = str_replace(scientific_name.x, " ", "_")) %>%
mutate(dispersal_km = dispersal_km + 0.0001) %>%
mutate(mean.hra.m2 = as.numeric(as.character(mean.hra.m2))) %>%
mutate(Migration_km = as.numeric(as.character(Migration_km))) %>%
mutate(media_simplified = as.factor(as.character(media_simplified)))
which(is.na(traits_phylo$class)) #42, Lontra canadensis
traits_phylo$class[42] <- "Mammalia"
########## mod 5 - diet ###########
bf_dispersal <- bf(dispersal_km ~ log(Mass_kg) + (1|p|diet_broadest_cat)) + Gamma(link = "log")
bf_home_range <- bf(mean.hra.m2 ~ log(Mass_kg)+ (1|p|diet_broadest_cat)) + Gamma(link = "log")
bf_migration <- bf(Migration_km ~ log(Mass_kg) + (1|p|diet_broadest_cat)) + hurdle_gamma(link = 'log')
mod5 <- brm(bf_dispersal + bf_home_range + bf_migration, data = traits_phylo,
control = list(adapt_delta = 0.995, max_treedepth = 15))
ggplot(traits, aes(x = log10(dispersal_km))) +
geom_histogram(aes(color = class), fill = "white",
position = "identity", bins = 30))
hist(log10(dispersal_km))
hist(log10(traits$dispersal_km))
hist(log10(traits_phylo$dispersal_km))
hist(log10(traits_phylo$Migration_km))
hist(log10(traits_phylo$mean.hra.m2))
View(traits_phylo)
hist(log10(traits_phylo$mass_kg))
hist(log10(traits_phylo$Mass_kg))
summary(mod5)
length(which(traits_phylo$class == "Amphibia"))
View(traits_phylo)
